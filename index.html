<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>×”×™×•× ×©×œ × ×™×ª××™</title>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        @keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }
        .animate-flash { animation: flash 0.5s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- × ×™×¨: ×›××Ÿ ×ª×“×‘×™×§ ××ª ×”×”×’×“×¨×•×ª ××”×¤×¨×•×™×§×˜ ×”×—×“×© ×©×¤×ª×—×ª ×‘-Firebase Console ---
        // ×•×•×“× ×©××ª×” ××—×œ×™×£ ××ª ×”××™×œ×™× ×‘×’×¨×©×™×™× ×‘×¢×¨×›×™× ×”×××™×ª×™×™× ×©×§×™×‘×œ×ª ×‘×©×œ×‘ 1 ×‘××“×¨×™×š.
     const firebaseConfig = {
  apiKey: "AIzaSyAs-pBJCOuozUGwEghgDAo7TV7gmeQUt1k",
  authDomain: "daily-routine-2edcb.firebaseapp.com",
  projectId: "daily-routine-2edcb",
  storageBucket: "daily-routine-2edcb.firebasestorage.app",
  messagingSenderId: "917221147096",
  appId: "1:917221147096:web:df1537d8d0e88e544372ad",
  measurementId: "G-RPBE9M2FNG"
};

        const isConfigured = firebaseConfig.apiKey !== "YOUR_KEY_HERE" && !firebaseConfig.apiKey.includes("REDACTED");

        if (isConfigured) {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        }

        const { useState, useEffect, useRef } = React;

        // --- SVG Icons ---
        const Icon = ({ name, className = "w-6 h-6" }) => {
            const icons = {
                trophy: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
                camera: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
                settings: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1V11a2 2 0 0 1-2-2 2 2 0 0 1 2-2v-.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            };
            return icons[name] || null;
        };

        const MOODS = [
            { id: 'happy', label: '×©××—', emoji: 'ğŸ˜Š', color: 'bg-green-50', border: 'border-green-200' },
            { id: 'neutral', label: '×›×›×” ×›×›×”', emoji: 'ğŸ˜', color: 'bg-yellow-50', border: 'border-yellow-200' },
            { id: 'sad', label: '×§×¦×ª ×§×©×” ×œ×™', emoji: 'ğŸ˜•', color: 'bg-red-50', border: 'border-red-200' }
        ];

        const ROUTINES = {
            morning: { title: '×‘×•×§×¨', tasks: [
                { id: 'm1', text: '××ª×¢×•×¨×¨×™× ×¢× ×—×™×•×š', icon: 'ğŸ˜Š' },
                { id: 'm3', text: '×¦×—×¦×•×— ×©×™× ×™×™×', icon: 'ğŸª¥', requiresPhoto: true },
                { id: 'm5', text: '×œ×‘×™×©×ª ×‘×’×“×™×', icon: 'ğŸ‘•' },
                { id: 'm7', text: '×¡×™×“×•×¨ ×”×ª×™×§', icon: 'ğŸ’', requiresPhoto: true }
            ]},
            afternoon: { title: '×¦×”×¨×™×™×', tasks: [
                { id: 'a1', text: '×©×˜×™×¤×ª ×™×“×™×™×', icon: 'ğŸ§¼' },
                { id: 'a2', text: '××¨×•×—×ª ×¦×”×¨×™×™×', icon: 'ğŸ½ï¸' },
                { id: 'a4', text: '×”×›× ×ª ×©×™×¢×•×¨×™×', icon: 'ğŸ“', requiresPhoto: true }
            ]},
            evening: { title: '×¢×¨×‘', tasks: [
                { id: 'e2', text: '××§×œ×—×ª', icon: 'ğŸš¿' },
                { id: 'e3', text: '×œ×‘×™×©×ª ×¤×™×’×³××”', icon: 'ğŸ˜´' },
                { id: 'e4', text: '×¦×—×¦×•×— ×©×™× ×™×™×', icon: 'ğŸª¥', requiresPhoto: true }
            ]}
        };

        function App() {
            if (!isConfigured) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-8 bg-blue-50 text-center">
                        <div className="max-w-md bg-white p-10 rounded-[40px] shadow-2xl border-4 border-blue-100">
                            <h1 className="text-4xl font-black text-blue-600 mb-6">×”×™×™ × ×™×¨! ğŸ‘‹</h1>
                            <p className="text-xl text-slate-600 mb-8 leading-relaxed font-bold">×”×©×œ×“ ××•×›×Ÿ, ×¢×›×©×™×• ×¨×§ ×¦×¨×™×š ×œ×—×‘×¨ ××ª ×”"×—×©××œ".</p>
                            <div className="text-right bg-slate-50 p-6 rounded-3xl border-2 border-slate-100 space-y-4">
                                <p className="font-black text-slate-800 underline">××” ×”×©×œ×‘ ×”×‘×?</p>
                                <p className="text-sm">×¢×‘×•×¨ ×¢×œ ×”××“×¨×™×š (deployment-guide.md) ×•×§×‘×œ ××ª ×”××¤×ª×—×•×ª ×-Firebase Console.</p>
                                <p className="text-sm">××—×¨×™ ×©×ª×“×‘×™×§ ××•×ª× ×‘×§×•×“, ×”××¤×œ×™×§×¦×™×” ×ª×ª×¢×•×¨×¨ ×œ×—×™×™×.</p>
                            </div>
                        </div>
                    </div>
                );
            }

            const [user, setUser] = useState(null);
            const [dayData, setDayData] = useState({ completed: [], totalPoints: 0, initialMood: null });
            const [activeRoutine, setActiveRoutine] = useState('morning');
            const [showWelcome, setShowWelcome] = useState(false);
            const [isCameraOpen, setIsCameraOpen] = useState(false);
            const [capturedImage, setCapturedImage] = useState(null);
            const [pendingTask, setPendingTask] = useState(null);
            
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const today = new Date().toISOString().split('T')[0];

            useEffect(() => {
                const auth = firebase.auth();
                const db = firebase.firestore();
                auth.signInAnonymously().catch(e => console.error(e));
                
                const unsubAuth = auth.onAuthStateChanged(u => {
                    setUser(u);
                    if (u) {
                        const docRef = db.collection('stats').doc(`${u.uid}_${today}`);
                        docRef.onSnapshot(doc => {
                            if (doc.exists) {
                                setDayData(doc.data());
                            } else {
                                docRef.set({ completed: [], totalPoints: 0, initialMood: null, date: today });
                                setShowWelcome(true);
                            }
                        });
                    }
                });
                return () => unsubAuth();
            }, [today]);

            const setMood = async (mood) => {
                const db = firebase.firestore();
                await db.collection('stats').doc(`${user.uid}_${today}`).update({ initialMood: mood });
                setShowWelcome(false);
            };

            const completeTask = async (taskId, photo = null) => {
                const db = firebase.firestore();
                await db.collection('stats').doc(`${user.uid}_${today}`).update({
                    completed: firebase.firestore.FieldValue.arrayUnion(taskId),
                    totalPoints: firebase.firestore.FieldValue.increment(10)
                });
                setIsCameraOpen(false);
                setCapturedImage(null);
            };

            const startCamera = async () => {
                setIsCameraOpen(true);
                setCapturedImage(null);
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                    if (videoRef.current) { videoRef.current.srcObject = stream; videoRef.current.play(); }
                } catch (e) { alert("××¦×œ××” ×œ× ×–××™× ×”"); setIsCameraOpen(false); }
            };

            const takePhoto = () => {
                const ctx = canvasRef.current.getContext('2d');
                canvasRef.current.width = 400; canvasRef.current.height = 300;
                ctx.drawImage(videoRef.current, 0, 0, 400, 300);
                const data = canvasRef.current.toDataURL('image/jpeg', 0.6);
                setCapturedImage(data);
                setTimeout(() => completeTask(pendingTask, data), 800);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative pb-20">
                    <canvas ref={canvasRef} className="hidden" />

                    {showWelcome && (
                        <div className="fixed inset-0 bg-white z-[200] flex flex-col items-center justify-center p-8 text-center">
                            <h2 className="text-4xl font-black mb-10 text-slate-800">×©×œ×•× × ×™×ª××™!<br/><span className="text-2xl text-slate-400">××™×š ××ª×” ××¨×’×™×© ×”×™×•×?</span></h2>
                            <div className="space-y-4 w-full">
                                {MOODS.map(m => (
                                    <button key={m.id} onClick={() => setMood(m.id)} className={`w-full flex items-center justify-between p-7 rounded-[35px] border-2 shadow-sm active:scale-95 transition-all ${m.color} ${m.border}`}>
                                        <span className="text-xl font-black text-slate-700">{m.label}</span>
                                        <span className="text-4xl">{m.emoji}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    <header className="sticky top-0 z-40 bg-white/95 backdrop-blur-md p-5 border-b border-slate-100 flex justify-between items-center">
                        <div className="bg-yellow-50 px-4 py-2 rounded-2xl border border-yellow-200 flex items-center gap-2">
                            <Icon name="trophy" className="w-5 h-5 text-yellow-500" />
                            <span className="font-black text-slate-700">{dayData.totalPoints || 0}</span>
                        </div>
                        <h1 className="text-2xl font-black text-slate-800 tracking-tight">×”×™×•× ×©×œ × ×™×ª××™</h1>
                        <div className="w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-200"><Icon name="settings" /></div>
                    </header>

                    <main className="p-5 space-y-6">
                        <div className="flex gap-2">
                            {Object.entries(ROUTINES).map(([key, r]) => (
                                <button key={key} onClick={() => setActiveRoutine(key)} className={`flex-1 py-4 rounded-2xl border-2 transition-all font-black text-sm ${activeRoutine === key ? 'bg-blue-600 text-white border-blue-600 shadow-lg' : 'bg-white text-slate-300 border-slate-100'}`}>
                                    {r.title}
                                </button>
                            ))}
                        </div>

                        <div className="space-y-4">
                            {ROUTINES[activeRoutine].tasks.map(t => {
                                const done = dayData.completed.includes(t.id);
                                return (
                                    <div key={t.id} onClick={() => !done && (t.requiresPhoto ? (setPendingTask(t.id), startCamera()) : completeTask(t.id))} 
                                         className={`p-6 rounded-[35px] border-2 flex items-center gap-5 transition-all ${done ? 'bg-green-50 border-green-100 opacity-60' : 'bg-white border-white shadow-md active:scale-95'}`}>
                                        <div className="text-4xl relative">
                                            {t.icon}
                                            {t.requiresPhoto && !done && <div className="absolute -top-1 -right-1 bg-blue-500 rounded-full p-1 border-2 border-white text-white"><Icon name="camera" className="w-3 h-3" /></div>}
                                        </div>
                                        <div className={`flex-1 font-black text-xl ${done ? 'text-slate-300 line-through' : 'text-slate-700'}`}>{t.text}</div>
                                        {done ? <div className="text-green-500 font-black text-2xl">âœ“</div> : <div className="w-8 h-8 border-2 border-slate-100 rounded-full" />}
                                    </div>
                                );
                            })}
                        </div>
                    </main>

                    {isCameraOpen && (
                        <div className="fixed inset-0 bg-black z-[300] flex flex-col items-center justify-between p-6">
                            <button onClick={() => setIsCameraOpen(false)} className="self-start text-white p-4 text-3xl font-black">âœ•</button>
                            <div className="relative w-full aspect-[3/4] rounded-[50px] overflow-hidden border-4 border-white/20">
                                {capturedImage ? <img src={capturedImage} className="w-full h-full object-cover scale-x-[-1]" /> : <video ref={videoRef} autoPlay playsInline muted className="w-full h-full object-cover scale-x-[-1]" />}
                            </div>
                            {!capturedImage && <button onClick={takePhoto} className="w-24 h-24 bg-white rounded-full border-8 border-slate-300 flex items-center justify-center mb-12 shadow-2xl active:scale-90 transition-transform"><div className="w-16 h-16 bg-blue-600 rounded-full" /></button>}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
